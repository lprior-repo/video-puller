Refactor the selected code to be more idiomatic Gleam. Focus on:
- Using pattern matching effectively
- Leveraging the Result and Option types properly
- Following Gleam naming conventions
- Making code more functional and immutable
